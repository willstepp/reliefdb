<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0; padding: 0 }
  #map-canvas { height: 100% }
</style>
<script type="text/javascript" src='https://maps.googleapis.com/maps/api/js?sensor=true&key=<%= GOOGLE_API_KEY %>'>
</script>
<script type="text/javascript">
  function initializeGuideMap() {
    console.log('inside initializeGuideMap started');

    var facilities = [
      <% @facilities.each_with_index do |f, i| %>
        <%= "#{f.to_json}#{"," unless (i == @facilities.count-1)}".html_safe %>
      <% end %>
    ];

    var mapOptions = {
      center: new google.maps.LatLng(<%= @facilities.count > 0 ? @facilities[0]['latitude'] : 0 %>, <%= @facilities.count > 0 ? @facilities[0]['longitude'] : 0 %>),
      zoom: 8
    };

    var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

    for(var i = 0; i < facilities.length; i++) {
      var marker = new google.maps.Marker({
          position: new google.maps.LatLng(facilities[i].latitude, facilities[i].longitude),
          animation: google.maps.Animation.DROP,
          map: map,
          title:facilities[i].name
      });
    }
    console.log('inside initializeGuideMap finished');
  }
</script>
<ul class="breadcrumbs" style="margin:0px">
  <li><%= link_to 'Search Again', root_path %></li>
  <li id="ui-back-to-results" class="hide"><%= link_to 'Back to Results', '#' %></li>
</ul>
<div id="ui-guide-results-container" class="row pad-large">
  <br>
  <h3>Guide Results</h3>
  <h5><%= "#{@facilities.count} of #{@facilities.count} Facilites within #{@radius} Miles" %></h5>
   <h5>
    <%= @relief_type %> Resources:&nbsp;
    <% @tags.each do |t| %>
      <%= t.name.titleize %>&nbsp;
    <% end %>
  </h5>

  <% if @facilities.count > 0 %>
    <br>
    <a href="#" id="ui-guide-map-button" class="button tiny radius secondary small-full-width">Show on map</a>
  <% end %>
  <hr>
  <div class="grid">
  <% @facilities.each do |f| %>
    <div class="grid-row">
      <div class="grid-col text-left pad-large underline grid-padding">
      <%= link_to f['name'], facility_path(f['id']) %>
      </div>
      <div class="grid-col text-right pad-large underline grid-padding">
        <span><%= "#{number_with_precision(f['distance'], :precision => 2)} miles" %></span>
      </div>
    </div>
  <% end %>
  </div>
</div>
<div id="map-canvas"/>
